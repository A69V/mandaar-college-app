<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Live Scorecard - Umang Mandar</title>
    <meta property="og:title" content="Live Score - Umang Mandar">
    <meta property="og:description" content="Check the live cricket scores for the Umang Mandar sports festival!">
    <meta property="og:image" content="https://your-website.com/images/default-og-image.png"> <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="public-style.css"> <link rel="manifest" href="/manifest.json">
    <style>
        /* --- Styles for Back Button & Share Button --- */
        /* (Assuming public-style.css has .header-bar, .page-title, .back-button) */
        .header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 800px; /* Match scorecard width */
            margin: 0 auto; /* Center */
            padding: 0 10px; /* Add padding */
            margin-bottom: 20px;
        }
        .page-title {
            color: var(--accent, #06b6d4);
            font-size: 1.5em;
            font-weight: 600;
            margin: 0;
            flex-grow: 1; /* Take available space */
        }
        .back-button {
            background: var(--glass, rgba(255,255,255,0.04));
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--muted, #9aa6b2);
            padding: 8px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.2s ease;
            margin-right: 10px; /* Space from share button */
        }
        .back-button:hover {
            background: rgba(255,255,255,0.15);
            color: #fff;
        }
        .share-button {
            background: var(--accent, #06b6d4);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex; /* For icon */
            align-items: center;
            gap: 5px;
        }
        .share-button:hover {
            background-color: #0891b2; /* Darker blue */
        }
        .share-button svg {
            width: 16px; height: 16px; fill: currentColor;
        }

        /* --- Scorecard Styles (from your previous code) --- */
        :root {
            --card: #0b1220; --muted: #9aa6b2; --accent: #06b6d4; --glass: rgba(255,255,255,0.04);
            --radius: 14px; --pad: 16px; --shadow: 0 6px 24px rgba(2,6,23,0.6);
        }
        body {
            /* ... (your existing body styles) ... */
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }
        main {
             flex-grow: 1; padding: 20px; margin-top: -100px; padding-top: 120px;
        }
        /* ... (all other styles: nav, .scorecard-container, .score-main, .live-stats, .pill, .ball-icon, .notification-area, etc.) ... */
        .scorecard-container { max-width: 800px; margin: 0 auto; /* Center container */ /* ... rest of styles ... */ }

    </style>
</head>
<body>
    <header>
        <nav class="top-nav">
            <a href="index.html" class="logo"><img src="./mandar-logo.png" alt="Umang Mandar"></a>
            <ul id="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="sports.html">Sports</a></li>
                <li><a href="timeline.html">Timeline</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
            <a href="#" class="live-btn" id="live-btn" style="display: none;">
                <div class="dot-blink"></div> <span id="live-btn-text">LIVE</span>
            </a>
            <button class="menu-toggle-btn" id="menu-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>
        </nav>
    </header>

    <main>
        <div class="header-bar">
            <a href="sports.html" id="back-link" class="back-button">&lt; Back</a>
            <h1 class="page-title" id="page-main-title">Live Scorecard</h1>
            <button class="share-button" id="share-button" style="display: none;"> <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"/></svg>
                Share
            </button>
        </div>

        <div class="scorecard-container">
            <p class="match-status" id="match-status">Loading match status...</p>
            <p class="target-info" id="target-info" style="display: none;"></p>
            <div id="notification-area"></div>

            <div class="score-main">
              <div>
                <div class="team-name" id="batting-team-name">--</div>
                <div class="muted">Batting</div>
              </div>
              <div style="text-align:right">
                <div class="score" id="main-score">0-0</div>
                <div class="overs" id="main-overs">(0.0)</div>
              </div>
            </div>

            <div class="batsman-bowler-card">
              <table class="live-stats"> ... <tbody> ... </tbody> </table>
              <hr style="border-color: var(--glass); margin: 15px 0;">
              <table class="live-stats"> ... <tbody> ... </tbody> </table>
            </div>

            <div class="info-pills">
              </div>

            <div class="over-summary-card">
                <label>This Over</label>
                <div class="over-summary" id="over-summary">
                  </div>
            </div>

             <p style="text-align: center; font-size: 0.8em; color: var(--muted); margin-top: 20px;">
                 Match data updates in real-time.
             </p>
        </div>
    </main>

    <footer>
        <p class="made-by">Made with ❤️ by <a href="https://github.com/A69V" target="_blank">Abhinav Shankar</a> | © 2025 GEC Banka Sports Club</p>
    </footer>

    <nav class="bottom-nav">
       </nav>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        // === PASTE YOUR FIREBASE CONFIG HERE ===
        const firebaseConfig = {
            apiKey: "AIzaSyAOtc2UrW2hXO4JJK5ZZQcDOfUVbEFmnis",
            authDomain: "umang-mandar.firebaseapp.com",
            projectId: "umang-mandar",
            storageBucket: "umang-mandar.firebasestorage.app",
            messagingSenderId: "1033556658773",
            appId: "1:1033556658773:web:ed5c606f77e792136ae2dc",
            databaseURL: "https://umang-mandar-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        // === END OF CONFIG ===

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- DOM Elements ---
        const el = { /* ... (all your existing 'el' elements) ... */ };
        let previousState = null; // Store the last state for comparisons

        // --- NEW: Selectors for new elements ---
        const shareButton = document.getElementById('share-button');
        const backLink = document.getElementById('back-link');
        const bottomNavBack = document.getElementById('bottom-nav-back'); // Assuming this ID exists in your bottom nav
        const menuBtn = document.getElementById('menu-toggle');
        const navLinks = document.getElementById('nav-links');
        // --- END NEW ---

        // --- Notification Function ---
        function showNotification(message, type = 'info', duration = 10000) { /* ... (your showNotification function) ... */ }

        // --- Render Function (Display Only) ---
        function renderScorecard(state) { /* ... (your renderScorecard function) ... */ }

        // --- Function to Check for Events ---
        function checkForEvents(currentState, prevState) { /* ... (your checkForEvents function) ... */ }
        
        // --- NEW: Helper function to update a meta tag ---
        function updateMetaTag(property, content) {
            let tag = document.querySelector(`meta[property="${property}"]`);
            if (!tag) {
                tag = document.createElement('meta');
                tag.setAttribute('property', property);
                document.head.appendChild(tag);
            }
            tag.setAttribute('content', content);
        }

        // --- Load Data ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const matchId = urlParams.get('matchId');

            if (!matchId) { /* ... (handle no match ID) ... */ return; }

            el.liveBtn.href = `live-scorecard.html?matchId=${matchId}`;
            console.log("Fetching live data for match:", matchId);
            const matchRef = ref(db, 'matches/' + matchId);

            onValue(matchRef, (snapshot) => {
                if (snapshot.exists()) {
                    const newState = snapshot.val();
                    if (newState.live && newState.teamA && newState.teamB) {
                        // ... (array conversions) ...
                        renderScorecard(newState); // Render the page content

                        // *** NEW: Update OG Tags & Back Button***
                        try {
                            const teamAName = newState.teamA.name || 'Team A';
                            const teamBName = newState.teamB.name || 'Team B';
                            const score = `${newState.live.score || 0}-${newState.live.wickets || 0}`;
                            const overs = `(${newState.live.overs || 0}.${newState.live.balls || 0})`;
                            const sport = newState.sport || 'cricket'; // Get sport

                            // 1. Construct the Dynamic Image URL
                            // *** REPLACE THIS with your actual service URL ***
                            const ogImageUrl = `https://your-serverless-function-url/generateOgImage?teamA=${encodeURIComponent(teamAName)}&teamB=${encodeURIComponent(teamBName)}&score=${encodeURIComponent(score)}&overs=${encodeURIComponent(overs)}`;

                            // 2. Update Meta Tags
                            updateMetaTag('og:title', `Live: ${teamAName} vs ${teamBName} | ${score} ${overs}`);
                            updateMetaTag('og:image', ogImageUrl);
                            // Optionally update description
                            updateMetaTag('og:description', `Follow the live ${sport} score for ${teamAName} vs ${teamBName} in the Umang Mandar sports festival.`);
                            
                            // 3. Update Back Button Links
                            const sportHubUrl = `sport-details.html?sport=${sport}`;
                            if (backLink) backLink.href = sportHubUrl;
                            if (bottomNavBack) bottomNavBack.href = sportHubUrl;

                        } catch (ogError) {
                            console.error("Error updating OG/Back tags:", ogError);
                        }
                        // *** END NEW ***
                        
                        if (previousState) {
                             checkForEvents(newState, previousState);
                        }
                        previousState = JSON.parse(JSON.stringify(newState)); // Store deep copy

                    } else { /* ... (handle incomplete data) ... */ }
                } else { /* ... (handle match not found) ... */ }
            }, (error) => { /* ... (handle Firebase error) ... */ });
            
            
            // --- NEW: Share Button Logic ---
            if (shareButton && navigator.share) {
                shareButton.style.display = 'flex'; // Show the button
                shareButton.addEventListener('click', async () => {
                    // Get current state data directly (it's loaded by now)
                    const state = previousState; // Use the most recent data
                    let shareTitle = "Live Score - Umang Mandar";
                    let shareText = "Check out the live scores for the Umang Mandar sports festival!";

                    if (state && state.live) {
                        const teamAName = state.teamA?.name || 'Team A';
                        const teamBName = state.teamB?.name || 'Team B';
                        const score = `${state.live.score || 0}-${state.live.wickets || 0}`;
                        const overs = `(${state.live.overs || 0}.${state.live.balls || 0})`;
                        
                        shareTitle = `Live: ${teamAName} vs ${teamBName}`;
                        shareText = `Follow the live score: ${state[state.live.battingTeam]?.name} are ${score} ${overs}.`;

                        if (state.status === "completed" && state.result) {
                             shareTitle = `Match Result: ${teamAName} vs ${teamBName}`;
                             shareText = `Umang Mandar Match Result: ${state.result}`;
                        }
                    }

                    try {
                        await navigator.share({
                            title: shareTitle,
                            text: shareText,
                            url: window.location.href, // Share the current page URL
                        });
                        console.log('Score shared successfully');
                    } catch (err) {
                        console.error('Error sharing score:', err);
                    }
                });
            } else if (shareButton) {
                 console.log("Web Share API not supported.");
                 shareButton.style.display = 'none'; // Hide if not supported
            }
            // --- END Share Button Logic ---

        }); // End DOMContentLoaded

         // --- Mobile Menu Toggle ---
         if(menuBtn && navLinks) {
             menuBtn.addEventListener('click', (e) => {
                 e.stopPropagation(); navLinks.classList.toggle('mobile-nav-active');
             });
             document.addEventListener('click', (e) => {
                 if (navLinks.classList.contains('mobile-nav-active') && !navLinks.contains(e.target) && !menuBtn.contains(e.target)) {
                     navLinks.classList.remove('mobile-nav-active');
                 }
             });
         }
    </script>

</body>
</html>