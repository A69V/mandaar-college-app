<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Live Scorecard - Umang Mandar</title>
    <meta property="og:title" content="Live Score - Umang Mandar">
    <meta property="og:description" content="Check the live cricket scores for the Umang Mandar sports festival!">
    <meta property="og:image" content="https://your-website.com/images/default-og-image.png"> <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="public-style.css"> <link rel="manifest" href="/manifest.json">
    <style>
        /* --- Styles for Back Button & Share Button --- */
        /* (Assuming public-style.css has .header-bar, .page-title, .back-button) */
        .header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 800px; /* Match scorecard width */
            margin: 0 auto; /* Center */
            padding: 0 10px; /* Add padding */
            margin-bottom: 20px;
        }
        .page-title {
            color: var(--accent, #06b6d4);
            font-size: 1.5em;
            font-weight: 600;
            margin: 0;
            flex-grow: 1; /* Take available space */
        }
        .back-button {
            background: var(--glass, rgba(255,255,255,0.04));
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--muted, #9aa6b2);
            padding: 8px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.2s ease;
            margin-right: 10px; /* Space from share button */
        }
        .back-button:hover {
            background: rgba(255,255,255,0.15);
            color: #fff;
        }
        .share-button {
            background: var(--accent, #06b6d4);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex; /* For icon */
            align-items: center;
            gap: 5px;
        }
        .share-button:hover {
            background-color: #0891b2; /* Darker blue */
        }
        .share-button svg {
            width: 16px; height: 16px; fill: currentColor;
        }

        /* --- Scorecard Styles (from your previous code) --- */
        :root {
            --card: #0b1220; --muted: #9aa6b2; --accent: #06b6d4; --glass: rgba(255,255,255,0.04);
            --radius: 14px; --pad: 16px; --shadow: 0 6px 24px rgba(2,6,23,0.6);
        }
        body {
            /* ... (your existing body styles) ... */
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }
        main {
             flex-grow: 1; padding: 20px; margin-top: -100px; padding-top: 120px;
        }
        /* ... (all other styles: nav, .scorecard-container, .score-main, .live-stats, .pill, .ball-icon, .notification-area, etc.) ... */
        .scorecard-container { max-width: 800px; margin: 0 auto; /* Center container */ /* ... rest of styles ... */ }

    </style>
</head>
<body>
    <header>
        <nav class="top-nav">
            <a href="index.html" class="logo"><img src="./mandar-logo.png" alt="Umang Mandar"></a>
            <ul id="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="sports.html">Sports</a></li>
                <li><a href="timeline.html">Timeline</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
            <a href="#" class="live-btn" id="live-btn" style="display: none;">
                <div class="dot-blink"></div> <span id="live-btn-text">LIVE</span>
            </a>
            <button class="menu-toggle-btn" id="menu-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>
        </nav>
    </header>

    <main>
        <div class="header-bar">
            <a href="sports.html" id="back-link" class="back-button">&lt; Back</a>
            <h1 class="page-title" id="page-main-title">Live Scorecard</h1>
            <button class="share-button" id="share-button" style="display: none;"> <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 0 24 24" width="18px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"/></svg>
                Share
            </button>
        </div>

        <div class="scorecard-container">
            <p class="match-status" id="match-status">Loading match status...</p>
            <p class="target-info" id="target-info" style="display: none;"></p>
            <div id="notification-area"></div>

            <div class="score-main">
              <div>
                <div class="team-name" id="batting-team-name">--</div>
                <div class="muted">Batting</div>
              </div>
              <div style="text-align:right">
                <div class="score" id="main-score">0-0</div>
                <div class="overs" id="main-overs">(0.0)</div>
              </div>
            </div>

            <div class="batsman-bowler-card">
              <table class="live-stats"> ... <tbody> ... </tbody> </table>
              <hr style="border-color: var(--glass); margin: 15px 0;">
              <table class="live-stats"> ... <tbody> ... </tbody> </table>
            </div>

            <div class="info-pills">
              </div>

            <div class="over-summary-card">
                <label>This Over</label>
                <div class="over-summary" id="over-summary">
                  </div>
            </div>

             <p style="text-align: center; font-size: 0.8em; color: var(--muted); margin-top: 20px;">
                 Match data updates in real-time.
             </p>
        </div>
    </main>

    <footer>
        <p class="made-by">Made with ❤️ by <a href="https://github.com/A69V" target="_blank">Abhinav Shankar</a> | © 2025 GEC Banka Sports Club</p>
    </footer>

    <nav class="bottom-nav">
       </nav>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        // === PASTE YOUR FIREBASE CONFIG HERE ===
        const firebaseConfig = {
            apiKey: "AIzaSyAOtc2UrW2hXO4JJK5ZZQcDOfUVbEFmnis",
            authDomain: "umang-mandar.firebaseapp.com",
            projectId: "umang-mandar",
            storageBucket: "umang-mandar.firebasestorage.app",
            messagingSenderId: "1033556658773",
            appId: "1:1033556658773:web:ed5c606f77e792136ae2dc",
            databaseURL: "https://umang-mandar-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        // === END OF CONFIG ===

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- DOM Elements (Initialize as empty object) ---
        // We will populate this object *after* the DOM loads
        let el = {}; 

        // --- State Variables ---
        let previousState = null; // Store the last state for comparisons

        // --- Notification Function ---
        function showNotification(message, type = 'info', duration = 10000) {
            if (!el.notificationArea) return;
            const notification = document.createElement('div');
            notification.classList.add('notification-message');
            if (type) {
                notification.classList.add(type);
            }
            notification.innerHTML = message;
            el.notificationArea.appendChild(notification);
            void notification.offsetWidth; // Trigger reflow
            notification.classList.add('visible');
            setTimeout(() => {
                notification.classList.remove('visible');
                notification.addEventListener('transitionend', () => {
                    try { el.notificationArea.removeChild(notification); } catch (e) {}
                }, { once: true });
            }, duration);
        }


        // --- Render Function (Display Only) ---
        function renderScorecard(state) {
            if (!state || !state.live) { /* ... */ return; }
            const live = state.live;
            /* ... (rest of renderScorecard function) ... */
             const striker = live.batsmen?.striker || { name: '--', runs: 0, balls: 0, fours: 0, sixes: 0 };
             const nonStriker = live.batsmen?.nonStriker || { name: '--', runs: 0, balls: 0, fours: 0, sixes: 0 };
             const bowler = live.bowler || { name: '--', overs: 0, balls: 0, maidens: 0, runs: 0, wickets: 0 };
             let currentStatus = live.matchStatus || "Status Unknown";
             if (state.status === "completed" && state.result) { /* ... */ } else if (live.matchStatus === "Innings Break") { /* ... */ }
             el.matchStatus.textContent = currentStatus;
             if (live.inning === 2 && live.targetScore) { /* ... */ } else { /* ... */ }
             el.battingTeamName.textContent = state[live.battingTeam]?.name || 'Batting Team';
             el.mainScore.textContent = `${live.score}-${live.wickets}`;
             el.mainOvers.textContent = `(${live.overs}.${live.balls})`;
             /* ... (rest of render logic for batsmen, bowler, pills, and over summary) ... */
        }

        // --- Function to Check for Events ---
        function checkForEvents(currentState, prevState) {
             if (!currentState?.live || !prevState?.live) return;
             /* ... (Your complete checkForEvents function logic) ... */
        }
        
        // --- Helper function to update a meta tag ---
        function updateMetaTag(property, content) {
            let tag = document.querySelector(`meta[property="${property}"]`);
            if (!tag) {
                tag = document.createElement('meta');
                tag.setAttribute('property', property);
                document.head.appendChild(tag);
            }
            tag.setAttribute('content', content);
        }

        // --- Load Data (and populate 'el' object) ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // *** FIX: Populate the 'el' object *inside* DOMContentLoaded ***
            el = {
                matchStatus: document.getElementById('match-status'),
                targetInfo: document.getElementById('target-info'),
                battingTeamName: document.getElementById('batting-team-name'),
                mainScore: document.getElementById('main-score'),
                mainOvers: document.getElementById('main-overs'),
                strikerName: document.getElementById('striker-name'),
                strikerRuns: document.getElementById('striker-runs'),
                strikerBalls: document.getElementById('striker-balls'),
                strikerFours: document.getElementById('striker-fours'),
                strikerSixes: document.getElementById('striker-sixes'),
                strikerSR: document.getElementById('striker-sr'),
                nonStrikerName: document.getElementById('nonstriker-name'),
                nonStrikerRuns: document.getElementById('nonstriker-runs'),
                nonStrikerBalls: document.getElementById('nonstriker-balls'),
                nonStrikerFours: document.getElementById('nonstriker-fours'),
                nonStrikerSixes: document.getElementById('nonstriker-sixes'),
                nonStrikerSR: document.getElementById('nonstriker-sr'),
                bowlerName: document.getElementById('bowler-name'),
                bowlerOvers: document.getElementById('bowler-overs'),
                bowlerMaidens: document.getElementById('bowler-maidens'),
                bowlerRuns: document.getElementById('bowler-runs'),
                bowlerWickets: document.getElementById('bowler-wickets'),
                bowlerEcon: document.getElementById('bowler-econ'),
                crr: document.getElementById('crr'),
                partnership: document.getElementById('partnership'),
                extras: document.getElementById('extras'),
                overSummary: document.getElementById('over-summary'),
                liveBtn: document.getElementById('live-btn'),
                notificationArea: document.getElementById('notification-area'),
                // New elements from the added HTML
                backLink: document.getElementById('back-link'),
                bottomNavBack: document.getElementById('bottom-nav-back'),
                menuBtn: document.getElementById('menu-toggle'),
                navLinks: document.getElementById('nav-links'),
                shareButton: document.getElementById('share-button')
            };
            // *** END FIX ***


            const urlParams = new URLSearchParams(window.location.search);
            const matchId = urlParams.get('matchId');

            if (!matchId) { 
                el.matchStatus.textContent = "Error: No Match ID specified in URL.";
                if (el.backLink) el.backLink.href = 'index.html';
                if (el.bottomNavBack) el.bottomNavBack.href = 'index.html';
                return; 
            }

            el.liveBtn.href = `live-scorecard.html?matchId=${matchId}`; // This line (219) will now work
            console.log("Fetching live data for match:", matchId);
            const matchRef = ref(db, 'matches/' + matchId);

            onValue(matchRef, (snapshot) => {
                if (snapshot.exists()) {
                    const newState = snapshot.val();
                    if (newState.live && newState.teamA && newState.teamB) {
                        // ... (array conversions) ...
                        const convertToArray = (obj) => obj && typeof obj === 'object' && !Array.isArray(obj) ? Object.values(obj) : obj;
                        if(newState.live.thisOverSummary) newState.live.thisOverSummary = convertToArray(newState.live.thisOverSummary);
                        if(newState.scorecard?.teamA?.batting) newState.scorecard.teamA.batting = convertToArray(newState.scorecard.teamA.batting);
                        if(newState.scorecard?.teamB?.batting) newState.scorecard.teamB.batting = convertToArray(newState.scorecard.teamB.batting);

                        renderScorecard(newState); // Render the page content

                        // --- Update OG Tags & Back Button ---
                        try {
                            const teamAName = newState.teamA.name || 'Team A';
                            const teamBName = newState.teamB.name || 'Team B';
                            const score = `${newState.live.score || 0}-${newState.live.wickets || 0}`;
                            const overs = `(${newState.live.overs || 0}.${newState.live.balls || 0})`;
                            const sport = newState.sport || 'cricket'; 

                            // Construct the Dynamic Image URL
                            // *** REPLACE THIS with your actual service URL ***
                            const ogImageUrl = `https://your-serverless-function-url/generateOgImage?teamA=${encodeURIComponent(teamAName)}&teamB=${encodeURIComponent(teamBName)}&score=${encodeURIComponent(score)}&overs=${encodeURIComponent(overs)}`;

                            // Update Meta Tags
                            updateMetaTag('og:title', `Live: ${teamAName} vs ${teamBName} | ${score} ${overs}`);
                            updateMetaTag('og:image', ogImageUrl);
                            updateMetaTag('og:description', `Follow the live ${sport} score for ${teamAName} vs ${teamBName} in the Umang Mandar sports festival.`);
                            
                            // Update Back Button Links
                            const sportHubUrl = `sport-details.html?sport=${sport}`;
                            if (el.backLink) el.backLink.href = sportHubUrl;
                            if (el.bottomNavBack) el.bottomNavBack.href = sportHubUrl;

                        } catch (ogError) {
                            console.error("Error updating OG/Back tags:", ogError);
                        }
                        
                        if (previousState) {
                             checkForEvents(newState, previousState);
                        }
                        previousState = JSON.parse(JSON.stringify(newState)); // Store deep copy

                    } else { /* ... (handle incomplete data) ... */ }
                } else { /* ... (handle match not found) ... */ }
            }, (error) => { /* ... (handle Firebase error) ... */ });
            
            
            // --- Share Button Logic ---
            if (el.shareButton && navigator.share) {
                el.shareButton.style.display = 'flex'; // Show the button
                el.shareButton.addEventListener('click', async () => {
                    const state = previousState; // Use the most recent data
                    let shareTitle = "Live Score - Umang Mandar";
                    let shareText = "Check out the live scores for the Umang Mandar sports festival!";

                    if (state && state.live) {
                        // ... (logic to build shareTitle and shareText) ...
                    }
                    try {
                        await navigator.share({ title: shareTitle, text: shareText, url: window.location.href });
                    } catch (err) { console.error('Error sharing score:', err); }
                });
            } else if (el.shareButton) {
                 el.shareButton.style.display = 'none'; // Hide if not supported
            }

        }); // End DOMContentLoaded

         // --- Mobile Menu Toggle ---
         if(menuBtn && navLinks) {
             menuBtn.addEventListener('click', (e) => {
                 e.stopPropagation(); navLinks.classList.toggle('mobile-nav-active');
             });
             document.addEventListener('click', (e) => {
                 if (navLinks.classList.contains('mobile-nav-active') && !navLinks.contains(e.target) && !menuBtn.contains(e.target)) {
                     navLinks.classList.remove('mobile-nav-active');
                 }
             });
         }
    </script>
</body>
</html>

</body>
</html>