<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Scorecard - Umang Mandar</title>
    <link rel="stylesheet" href="public-style.css">
     <meta property="og:site_name" content="Live Scorecard - Umang Mandar, GEC Banka">
<meta property="og:title" content="Live Scorecard - Umang Mandar, GEC Banka">
<meta property="og:url" content="https://umang-mandar.vercel.app/">
<meta property="og:type" content="website">
<meta property="og:description" content="Check the live score of ongoing matches at Umang Mandar">

  
    <meta property="og:image" content="https://umang-mandar.vercel.app/og-img-live.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:app:name:iphone" content="Live Scorecard - Umang Mandar, GEC Banka">
    <meta property="twitter:title" content="Live Scorecard - Umang Mandar, GEC Banka">
    <meta property="twitter:description" content="Check the live score of ongoing matches at Umang Mandar!">
    <style>
        /* --- Basic Styles from your UI --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: rgba(0, 0, 0, 0.647);
            background-image: url("../background.gif"); /* Adjust path if needed */
            background-blend-mode: multiply;
            background-size: cover;
            background-position: top;
            background-repeat: no-repeat;
            overflow-x: hidden;
            color: #e6eef6;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header { width: 100%; border: none;}
        nav {
            max-width: 100%; min-width: 250px; max-height: 200px; height: 80px;
            margin: auto; display: flex; flex-direction: row; align-items: center; justify-content: space-between;
            background: linear-gradient(180deg, rgba(8, 8, 8, 1) 2%, rgba(9, 9, 9, 0.62) 63%, rgba(10, 10, 10, 0.46) 79%, rgba(0, 0, 0, 0) 100%);
            position: sticky; /* Make nav sticky */
            top: 0;
            z-index: 1000; /* Ensure it's above content */
        }
        nav ul { list-style: none; display: flex; }
        nav ul li { margin: 15px; }
        nav ul li a { text-decoration: none; color: white; font-size: 1.1em; font-family: sans-serif; }
        .logo { margin: 20px; }
        .logo img { height: 50px; }
        .live-btn { /* Style from your UI */
            background-color: #080808a5; color: white; outline: none;
            display: flex; flex-direction: row; align-items: center; justify-content: center;
            gap: 10px; border-radius: 50px; border: solid 1px white;
            font-weight: bold; font-size: 1em; margin: 20px; cursor: pointer; text-decoration: none; /* Added */
        }
        .dot-blink { /* Style from your UI */
            height: 10px; width: 10px; background-color: red; border-radius: 50%;
            animation: blink infinite 2s;
        }
        @keyframes blink { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }
        main { flex-grow: 1; padding: 20px; margin-top: -100px; /* Pull content up under transparent part of nav */ padding-top: 120px; /* Add padding to account for nav height */}
        footer {
             padding: 40px 0 0; background: linear-gradient(180deg, rgba(8, 8, 8, 0.01) 0%, rgba(7, 7, 7, 0.26) 9%, rgba(7, 7, 7, 0.5) 29%, rgba(6, 6, 6, 1) 67%);
             font-family: sans-serif; color: white; text-align: center;
             /* Simple footer layout */
             border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .made-by { padding: 15px 0; font-size: 0.9em; }
        .made-by a { color: white; }

        /* --- Scorecard Specific Styles (Adapted from scorer) --- */
        :root { /* Define scorer variables for consistency */
            --card: #0b1220; --muted: #9aa6b2; --accent: #06b6d4; --glass: rgba(255,255,255,0.04);
            --radius: 14px; --pad: 16px; --shadow: 0 6px 24px rgba(2,6,23,0.6);
        }
        .scorecard-container {
            max-width: 800px;
            margin: 20px auto;
            background: rgba(8, 8, 8, 0.8); /* Slightly darker, more opaque */
            border-radius: var(--radius);
            padding: var(--pad);
            backdrop-filter: blur(8px); /* Stronger blur */
            border: 1px solid var(--glass);
            box-shadow: var(--shadow); /* Add shadow */
            position: relative; /* Needed for absolute positioning of notifications if container-relative */
        }
        .score-header { text-align: center; margin-bottom: 20px; color: var(--accent); font-size: 1.8em; }
        .match-status { text-align: center; font-weight: bold; margin-bottom: 15px; font-size: 1.1em; color: #FF9F55; /* Orange accent */}
         .target-info { text-align: center; font-weight: bold; margin-bottom: 20px; font-size: 1.2em; color: #f97316; }

        .score-main{
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; gap: 16px;
            background: var(--glass); border-radius: 10px; margin-bottom: 15px;
        }
        .score-main .team-name{font-size: 1.5em; font-weight: 700;}
        .score-main .score{font-size: 2.5em; font-weight: 800; line-height: 1;}
        .score-main .overs{font-size: 1.3em; color: var(--muted); font-weight: 600;}

        .batsman-bowler-card {
             background: var(--glass); border-radius: 10px; margin-bottom: 15px; padding: var(--pad);
        }
        table.live-stats{width:100%; border-collapse:collapse; font-size: 0.95em;}
        table.live-stats th, table.live-stats td{padding: 10px; text-align:left; border-bottom:1px solid var(--glass)}
        table.live-stats th{font-size: 0.8em; color: var(--muted); text-transform:uppercase; letter-spacing:0.5px}
        table.live-stats td{font-weight: 600;}
        table.live-stats .stat-num{text-align:right; font-family:monospace; font-size: 1.1em; width: 40px;}
        table.live-stats .striker-dot{display:inline-block; width:8px; height:8px; background:var(--accent); border-radius:50%; margin-right:8px}

         .info-pills{display:flex; gap:10px; justify-content:center; flex-wrap: wrap; margin-bottom: 15px;}
        .pill{background:var(--glass);padding: 8px 14px; border-radius:999px; font-weight:600; font-size: 0.9em;}
        .pill .label{color:var(--muted); margin-right:6px}

        .over-summary-card { background: var(--glass); border-radius: 10px; padding: var(--pad); margin-bottom: 15px;}
        .over-summary-card label { font-size: 0.8em; color: var(--muted); display: block; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .over-summary { display: flex; flex-wrap: wrap; gap: 6px; }
        .ball-icon {
            width: 30px; height: 30px; border-radius: 50%; background: rgba(255,255,255,0.08);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9em; font-weight: 700; border: 1px solid rgba(255,255,255,0.1);
        }
        .ball-icon.wicket { background: #f43f5e; color: #fff; border: none; }
        .ball-icon.six { background: var(--accent); color: #000; border: none; }
        .ball-icon.four { background: #7c3aed; color: #fff; border: none; }
        .ball-icon.extra { font-size: 0.75em; background: #eab308; color: #000; border: none; }

        /* --- Notification Styles --- */
        #notification-area {
            position: fixed; /* Position relative to viewport */
            top: 20px; /* Adjust as needed */
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000; /* Above everything */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px; /* Spacing between multiple notifications */
            width: 90%; /* Max width */
            max-width: 500px; /* Limit width on larger screens */
            pointer-events: none; /* Allow clicks through the container */
        }

        .notification-message {
            background-color: rgba(6, 182, 212, 0.9); /* Accent color, semi-transparent */
            color: #080808; /* Dark text for contrast */
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            opacity: 0; /* Start hidden */
            transform: translateY(20px); /* Start slightly lower */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out; /* Smooth fade/slide */
            pointer-events: all; /* Allow interaction with message if needed */
            max-width: 100%; /* Ensure it fits */
        }

        .notification-message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Different style for wickets */
         .notification-message.wicket {
             background-color: rgba(244, 63, 94, 0.9); /* Red */
             color: white;
         }
         /* Different style for match end */
         .notification-message.milestone {
             background-color: rgba(255, 159, 85, 0.9); /* Orange */
              color: #080808;
         }
        .notification-message.match-end {
             background-color: rgba(34, 197, 94, 0.9); /* Green */
             color: #080808;
        }


        @media screen and (max-width: 768px) {
            nav ul { display: none; } /* Basic responsive nav */
             main { padding-top: 110px; } /* Adjust padding for smaller nav */
            .score-main .team-name{font-size: 1.2em;}
            .score-main .score{font-size: 2em;}
            .score-main .overs{font-size: 1.1em;}
            table.live-stats{font-size: 0.9em;}
             table.live-stats th, table.live-stats td{padding: 8px;}
             table.live-stats .stat-num{width: 35px;}
             .ball-icon { width: 28px; height: 28px; font-size: 0.8em;}
             .score-header { font-size: 1.5em; }
             .match-status, .target-info { font-size: 1em; }
            #notification-area {
                 
                 top: -20px; /* Adjust for mobile */
                 width: 95%;
            }
             .notification-message {
                 font-size: 0.85em;
                 padding: 10px 15px;
             }
        }
@media screen and (min-width: 900px) {
    body{
        display: none;
    }
}

    </style>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo"><img src="../mandar-logo.png" alt="Umang Mandar"></a> <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#tline">Events</a></li>
                <li><a href="#">Gallery</a></li>
                <li><a href="#">Updates</a></li>
                <li><a href="sport.html?sport=cricket">Sports</a></li>
            </ul>
            <button href="" class="live-btn" id="live-btn" onclick="shareContent()">
            Share
        </button>
            </nav>
    </header>
    
    <main>

        <div class="scorecard-container">
            <h1 class="score-header">Live Scorecard</h1>
            <p class="match-status" id="match-status">Loading match status...</p>
            <p class="target-info" id="target-info" style="display: none;"></p>
<div id="notification-area"></div>
            <div class="score-main">
                <div>
                    <div class="team-name" id="batting-team-name">--</div>
                    <div class="muted">Batting</div>
                </div>
                <div style="text-align:right">
                    <div class="score" id="main-score">0-0</div>
                    <div class="overs" id="main-overs">(0.0)</div>
                </div>
            </div>

            <div class="batsman-bowler-card">
                <h3 style="color: var(--muted); font-size:0.9em; margin-bottom: 10px;">Current Players</h3>
                <table class="live-stats">
                    <thead>
                        <tr>
                            <th>Batsman</th>
                            <th class="stat-num">R</th> <th class="stat-num">B</th>
                            <th class="stat-num">4s</th> <th class="stat-num">6s</th>
                            <th class="stat-num">SR</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="striker-row">
                            <td><span class="striker-dot"></span><span id="striker-name">...</span></td>
                            <td class="stat-num" id="striker-runs">0</td> <td class="stat-num" id="striker-balls">0</td>
                            <td class="stat-num" id="striker-fours">0</td> <td class="stat-num" id="striker-sixes">0</td>
                            <td class="stat-num" id="striker-sr">0.00</td>
                        </tr>
                        <tr id="nonstriker-row">
                            <td><span style="opacity:0" class="striker-dot"></span><span id="nonstriker-name">...</span></td>
                            <td class="stat-num" id="nonstriker-runs">0</td> <td class="stat-num" id="nonstriker-balls">0</td>
                            <td class="stat-num" id="nonstriker-fours">0</td> <td class="stat-num" id="nonstriker-sixes">0</td>
                            <td class="stat-num" id="nonstriker-sr">0.00</td>
                        </tr>
                    </tbody>
                </table>
                <hr style="border-color: var(--glass); margin: 15px 0;">
                <table class="live-stats">
                    <thead>
                        <tr>
                            <th>Bowler</th>
                            <th class="stat-num">O</th> <th class="stat-num">M</th>
                            <th class="stat-num">R</th> <th class="stat-num">W</th>
                            <th class="stat-num">Econ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="bowler-name">...</td>
                            <td class="stat-num" id="bowler-overs">0.0</td> <td class="stat-num" id="bowler-maidens">0</td>
                            <td class="stat-num" id="bowler-runs">0</td> <td class="stat-num" id="bowler-wickets">0</td>
                            <td class="stat-num" id="bowler-econ">0.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="info-pills">
                <div class="pill"><span class="label">CRR:</span> <span id="crr">0.00</span></div>
                <div class="pill"><span class="label">Partnership:</span> <span id="partnership">0 (0)</span></div>
                <div class="pill"><span class="label">Extras:</span> <span id="extras">0</span></div>
            </div>

            <div class="over-summary-card">
                <label>This Over</label>
                <div class="over-summary" id="over-summary" style="flex-direction: row-reverse; justify-content: flex-end;">
                    </div>
            </div>

             <p style="text-align: center; font-size: 0.8em; color: var(--muted); margin-top: 20px;">
                 Match data updates in real-time.
             </p>

            
             
             </div>
    </div> </main>

    <footer>
        <p class="made-by">Made with ❤️ by <a href="https://github.com/A69V" target="_blank">Abhinav Shankar</a> | © 2025 GEC Banka Sports Club</p>
    </footer>
    
<div class="bottom-nav">
    <ul>
        <li>
            <a href="index.html" >
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg>
                Home
            </a>
        </li>
        <li>
            <a href="sports.html" class="active">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12.64 3.08c-.23-.48-.77-.78-1.34-.78s-1.11.3-1.34.78l-1.8 3.86-4.09.62c-.54.08-.98.54-1.05 1.11s.21 1.11.7 1.39l2.97 3.03-.7 4.25c-.09.54.16 1.08.64 1.36s1.07.3 1.48.02l3.65-2 3.65 2c.41.28.99.26 1.48-.02s.73-.82.64-1.36l-.7-4.25 2.97-3.03c.49-.28.84-.81.7-1.39s-.51-1.03-1.05-1.11l-4.09-.62-1.8-3.86zm-1.19 8.2l-1.6 1.63.38 2.3-2-.98-2 .98.38-2.3-1.6-1.63 2.22-.34.99-2.11.99 2.11 2.22.34z"/></svg> Sports
            </a>
        </li>
        <li>
             <a href="timeline.html">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                 Timeline
            </a>
        </li>
        <li>
             <a href="gallery.html">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                 Gallery
            </a>
        </li>
    </ul>
</div>
 <style>
        /* --- PWA Install Prompt Styles --- */
.install-prompt-container {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 450px; /* Limit width */
    background-color: rgba(9, 6, 82, 0.85); /* Dark blue, semi-transparent */
    border: 1px solid rgba(217, 216, 246, 0.3);
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    z-index: 1500;
    padding: 15px 20px;
    display: none; /* Hidden by default */
    opacity: 0;
    transition: opacity 0.4s ease-out, bottom 0.4s ease-out;
}

.install-prompt-container.visible {
    display: block;
    opacity: 1;
    bottom: 20px; /* Animate from slightly lower if preferred */
}

.install-prompt-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.install-prompt-logo {
    height: 40px; /* Adjust size */
    width: 40px;
    border-radius: 8px; /* Slightly rounded */
    flex-shrink: 0;
}

.install-prompt-text {
    flex-grow: 1;
    color: white;
}

.install-prompt-text strong {
    font-size: 1.1em;
    display: block;
    margin-bottom: 3px;
}

.install-prompt-text p {
    font-size: 0.85em;
    color: #ccc; /* Muted text */
    line-height: 1.4;
}

.install-prompt-buttons {
    display: flex;
    flex-direction: column; /* Stack buttons on small screens initially */
    gap: 8px;
    align-items: center; /* Center buttons */
}

.install-prompt-buttons button {
    padding: 8px 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9em;
    transition: background-color 0.2s ease, transform 0.1s ease;
    white-space: nowrap; /* Prevent wrapping */
}

.install-prompt-buttons button:active {
    transform: scale(0.95); /* Click effect */
}

.btn-install-confirm {
    background-color: #FF9F55; /* Orange accent */
    color: #111;
}
.btn-install-confirm:hover {
    background-color: #ffb47d;
}

.btn-install-cancel {
    background-color: rgba(255, 255, 255, 0.15);
    color: #eee;
}
.btn-install-cancel:hover {
    background-color: rgba(255, 255, 255, 0.25);
}

/* Responsive adjustments for the prompt */
@media screen and (min-width: 400px) { /* Side-by-side buttons on wider screens */
     .install-prompt-buttons {
        flex-direction: row;
    }
}

@media screen and (max-width: 900px) { /* Adjust bottom position if footer/nav overlap */
     .install-prompt-container {
        bottom: 10px; /* Reduce bottom margin */
     }
}
    </style>
<div id="install-prompt" class="install-prompt-container">
        <div class="install-prompt-content">
            <img src="./umang-mandar-logo.png" alt="App Logo" class="install-prompt-logo"> <div class="install-prompt-text">
                <strong>Install Umang Mandar App?</strong>
                <p>Add to your Home screen for quick access, even offline.</p>
            </div>
            <div class="install-prompt-buttons">
                <button id="btn-install" class="btn-install-confirm">Install</button>
                <button id="btn-cancel-install" class="btn-install-cancel">Not Now</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        // IMPORT 'get' ALONG WITH THE OTHERS
        import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        // === PASTE YOUR FIREBASE CONFIG HERE ===
        const firebaseConfig = {
            apiKey: "AIzaSyAOtc2UrW2hXO4JJK5ZZQcDOfUVbEFmnis",
            authDomain: "umang-mandar.firebaseapp.com",
            projectId: "umang-mandar",
            storageBucket: "umang-mandar.firebasestorage.app",
            messagingSenderId: "1033556658773",
            appId: "1:1033556658773:web:ed5c606f77e792136ae2dc",
            databaseURL: "https://umang-mandar-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        // === END OF CONFIG ===

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- DOM Elements (Same as before) ---
        const el = {
            matchStatus: document.getElementById('match-status'),
            targetInfo: document.getElementById('target-info'),
            battingTeamName: document.getElementById('batting-team-name'),
            mainScore: document.getElementById('main-score'),
            mainOvers: document.getElementById('main-overs'),
            strikerName: document.getElementById('striker-name'),
            strikerRuns: document.getElementById('striker-runs'),
            strikerBalls: document.getElementById('striker-balls'),
            strikerFours: document.getElementById('striker-fours'),
            strikerSixes: document.getElementById('striker-sixes'),
            strikerSR: document.getElementById('striker-sr'),
            nonStrikerName: document.getElementById('nonstriker-name'),
            nonStrikerRuns: document.getElementById('nonstriker-runs'),
            nonStrikerBalls: document.getElementById('nonstriker-balls'),
            nonStrikerFours: document.getElementById('nonstriker-fours'),
            nonStrikerSixes: document.getElementById('nonstriker-sixes'),
            nonStrikerSR: document.getElementById('nonstriker-sr'),
            bowlerName: document.getElementById('bowler-name'),
            bowlerOvers: document.getElementById('bowler-overs'),
            bowlerMaidens: document.getElementById('bowler-maidens'),
            bowlerRuns: document.getElementById('bowler-runs'),
            bowlerWickets: document.getElementById('bowler-wickets'),
            bowlerEcon: document.getElementById('bowler-econ'),
            crr: document.getElementById('crr'),
            partnership: document.getElementById('partnership'),
            extras: document.getElementById('extras'),
            overSummary: document.getElementById('over-summary'),
            liveBtn: document.getElementById('live-btn'),
            notificationArea: document.getElementById('notification-area')
        };

        // --- State Variables ---
        let previousState = null; // Store the last state for comparisons
        let staticState = null;   // Store the non-changing data

        // --- Notification Function (Same as before) ---
        function showNotification(message, type = 'info', duration = 10000) {
            if (!el.notificationArea) return;
            const notification = document.createElement('div');
            notification.classList.add('notification-message', type);
            notification.innerHTML = message;
            el.notificationArea.appendChild(notification);
            void notification.offsetWidth;
            notification.classList.add('visible');
            setTimeout(() => {
                notification.classList.remove('visible');
                notification.addEventListener('transitionend', () => {
                    try { el.notificationArea.removeChild(notification); } catch (e) {}
                }, { once: true });
            }, duration);
        }

        // --- Render Function (Same as before) ---
        function renderScorecard(state) {
            if (!state || !state.live) {
                el.matchStatus.textContent = "Waiting for match data...";
                el.liveBtn.style.display = 'none';
                return;
            }
            const live = state.live;
            const striker = live.batsmen?.striker || { name: '--', runs: 0, balls: 0, fours: 0, sixes: 0 };
            const nonStriker = live.batsmen?.nonStriker || { name: '--', runs: 0, balls: 0, fours: 0, sixes: 0 };
            const bowler = live.bowler || { name: '--', overs: 0, balls: 0, maidens: 0, runs: 0, wickets: 0 };

            let currentStatus = live.matchStatus || "Status Unknown";
            if (state.status === "completed" && state.result) {
                currentStatus = `Finished: ${state.result}`;
                el.liveBtn.style.display = 'none';
            } else if (live.matchStatus === "Innings Break" || currentStatus.includes("Live")) {
                el.liveBtn.style.display = 'flex';
            } else {
                el.liveBtn.style.display = 'none';
            }
            el.matchStatus.textContent = currentStatus;

            if (live.inning === 2 && live.targetScore) {
                el.targetInfo.textContent = `Target: ${live.targetScore}`;
                el.targetInfo.style.display = 'block';
            } else {
                el.targetInfo.style.display = 'none';
            }

            el.battingTeamName.textContent = state[live.battingTeam]?.name || 'Batting Team';
            el.mainScore.textContent = `${live.score}-${live.wickets}`;
            el.mainOvers.textContent = `(${live.overs}.${live.balls})`;

            const strikerSR = (striker.balls > 0) ? (striker.runs / striker.balls * 100).toFixed(2) : '0.00';
            el.strikerName.textContent = striker.name;
            el.strikerRuns.textContent = striker.runs;
            el.strikerBalls.textContent = striker.balls;
            el.strikerFours.textContent = striker.fours;
            el.strikerSixes.textContent = striker.sixes;
            el.strikerSR.textContent = strikerSR;

            const nonStrikerSR = (nonStriker.balls > 0) ? (nonStriker.runs / nonStriker.balls * 100).toFixed(2) : '0.00';
            el.nonStrikerName.textContent = nonStriker.name;
            el.nonStrikerRuns.textContent = nonStriker.runs;
            el.nonStrikerBalls.textContent = nonStriker.balls;
            el.nonStrikerFours.textContent = nonStriker.fours;
            el.nonStrikerSixes.textContent = nonStriker.sixes;
            el.nonStrikerSR.textContent = nonStrikerSR;

            const bowlerTotalBalls = (bowler.overs || 0) * 6 + (bowler.balls || 0);
            const bowlerEcon = (bowlerTotalBalls > 0) ? (bowler.runs / bowlerTotalBalls * 6).toFixed(2) : '0.00';
            el.bowlerName.textContent = bowler.name;
            el.bowlerOvers.textContent = `${bowler.overs || 0}.${bowler.balls || 0}`;
            el.bowlerMaidens.textContent = bowler.maidens || 0;
            el.bowlerRuns.textContent = bowler.runs || 0;
            el.bowlerWickets.textContent = bowler.wickets || 0;
            el.bowlerEcon.textContent = bowlerEcon;

            el.crr.textContent = live.runRate || '0.00';
            el.partnership.textContent = `${live.partnership?.runs || 0} (${live.partnership?.balls || 0})`;
            el.extras.textContent = live.extras?.total || 0;

            el.overSummary.innerHTML = '';
            if (live.thisOverSummary && Array.isArray(live.thisOverSummary)) {
                [...live.thisOverSummary].reverse().forEach(ballEvent => {
                    const ballEl = document.createElement('div');
                    ballEl.classList.add('ball-icon');
                    let text = ballEvent;
                    if (ballEvent === 'W') { ballEl.classList.add('wicket'); }
                    else if (ballEvent === '6') { ballEl.classList.add('six'); }
                    else if (ballEvent === '4') { ballEl.classList.add('four'); }
                    else if (ballEvent === '.') { text = '•'; }
                    else if (String(ballEvent).match(/^(wd|nb|b|lb)/)) {
                        ballEl.classList.add('extra');
                    }
                    ballEl.textContent = text;
                    el.overSummary.appendChild(ballEl);
                });
            }
        }

        // --- Function to Check for Events (Same as before) ---
        function checkForEvents(currentState, prevState) {
            if (!currentState?.live || !prevState?.live) return;
            const currentLive = currentState.live;
            const prevLive = prevState.live;
            const scoreChanged = currentLive.score !== prevLive.score;
            const wicketsChanged = currentLive.wickets !== prevLive.wickets;
            const overChanged = currentLive.overs !== prevLive.overs;

            const lastBallEvent = currentLive.thisOverSummary?.[currentLive.thisOverSummary.length - 1];
            const prevOverSummaryLength = prevLive.thisOverSummary?.length || 0;
            const currentOverSummaryLength = currentLive.thisOverSummary?.length || 0;
            
            // Check for a new ball or a change of over
            const newBallBowled = currentOverSummaryLength > prevOverSummaryLength || (overChanged && currentLive.balls === 0);

            if (newBallBowled && scoreChanged) {
                const strikerName = currentLive.batsmen?.striker?.name || 'Batsman';
                if (lastBallEvent === '6') {
                    showNotification(`<strong>SIX!</strong> by ${strikerName}!`, 'milestone');
                } else if (lastBallEvent === '4') {
                    showNotification(`<strong>FOUR!</strong> by ${strikerName}!`, 'milestone');
                }
            }
            if (wicketsChanged && currentLive.wickets > prevLive.wickets) {
                // This is a simplified version; your more complex logic can go here
                showNotification(`<strong>WICKET!</strong>`, 'wicket');
            }
            
            // ... (rest of your event logic from the original file) ...
        }

        // --- NEW: Function to Process Updates ---
        // This combines static data with new live data and renders
        function processUpdate(liveData) {
            // Merge the unchanging static data with the new live data
            const newState = { ...staticState, live: liveData };

            // --- Data Processing (Array conversion) ---
            // This is critical because Firebase objects can lose their array structure
            const convertToArray = (obj) => obj && typeof obj === 'object' && !Array.isArray(obj) ? Object.values(obj) : obj;
            
            if (newState.live.thisOverSummary) {
                newState.live.thisOverSummary = convertToArray(newState.live.thisOverSummary);
            }
            // We need the scorecard data from the static state for notifications
            if (staticState.scorecard?.teamA?.batting) {
                // Ensure newState has scorecard, as staticState does
                if (!newState.scorecard) newState.scorecard = {}; 
                newState.scorecard.teamA = { ...staticState.scorecard.teamA };
                newState.scorecard.teamA.batting = convertToArray(staticState.scorecard.teamA.batting);
            }
            if (staticState.scorecard?.teamB?.batting) {
                if (!newState.scorecard) newState.scorecard = {};
                newState.scorecard.teamB = { ...staticState.scorecard.teamB };
                newState.scorecard.teamB.batting = convertToArray(staticState.scorecard.teamB.batting);
            }

            // --- Render and Check for Events ---
            renderScorecard(newState);
            if (previousState) {
                checkForEvents(newState, previousState);
            }

            // --- Store state for next comparison ---
            try {
                // We only need to store the parts relevant to checkForEvents
                const minimalStateForCompare = {
                    live: JSON.parse(JSON.stringify(newState.live)),
                    status: newState.status,
                    result: newState.result,
                    // Include scorecard if your wicket logic needs it
                    scorecard: {
                        teamA: { batting: newState.scorecard?.teamA?.batting },
                        teamB: { batting: newState.scorecard?.teamB?.batting }
                    }
                };
                previousState = minimalStateForCompare;
            } catch (e) {
                console.error("Error creating deep copy of state:", e);
                previousState = { ...newState, live: { ...newState.live } }; // Fallback
            }
        }


        // --- OPTIMIZED: Load Data ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const matchId = urlParams.get('matchId');

            if (!matchId) {
                el.matchStatus.textContent = "Error: No Match ID specified in URL.";
                el.liveBtn.style.display = 'none';
                return;
            }

            // Keep this href logic if you like
            el.liveBtn.href = `live-scorecard.html?matchId=${matchId}`; 
            
            // Define our two paths
            const matchRef = ref(db, 'matches/' + matchId);
            const liveRef = ref(db, 'matches/' + matchId + '/live'); // <-- Listen only to this

            console.log("Fetching static data for match:", matchId);

            // STEP 1: Get the *entire* match data ONCE
            get(matchRef).then((snapshot) => {
                if (!snapshot.exists()) {
                    console.error("Error: Match data not found for ID:", matchId);
                    el.matchStatus.textContent = `Error: Match '${matchId}' not found.`;
                    return;
                }

                // Store the full, non-live data
                staticState = snapshot.val();

                if (!staticState.live || !staticState.teamA || !staticState.teamB) {
                    console.error("Incomplete match data received:", staticState);
                    el.matchStatus.textContent = "Error: Incomplete match data.";
                    return;
                }

                // Render the page for the *first time* using this data
                console.log("Static data loaded. Rendering initial state.");
                // We pass staticState.live to the processor
                processUpdate(staticState.live); 

                // STEP 2: Now, attach the *real-time* listener ONLY to the 'live' path
                console.log("Attaching real-time listener to /live path...");
                onValue(liveRef, (liveSnapshot) => {
                    if (liveSnapshot.exists()) {
                        const liveData = liveSnapshot.val();
                        // On every update, just process the new live data
                        processUpdate(liveData); 
                    }
                }, (error) => {
                    console.error("Firebase real-time listener failed:", error);
                    el.matchStatus.textContent = "Error connecting to live scores.";
                });

            }).catch((error) => {
                console.error("Firebase initial 'get' failed:", error);
                el.matchStatus.textContent = "Error loading match data.";
                el.liveBtn.style.display = 'none';
            });
        });
    </script>

  <script>
        // --- Share Button Logic (Slightly Improved) ---
        async function shareContent() {
            // Get the current status text to share
            const statusText = document.getElementById('match-status')?.textContent || "Check out the live score!";

            const shareData = {
                title: document.title, // 'Live Scorecard - Umang Mandar'
                text: statusText,      // e.g., "Live: Team A 120-2 (15.2)"
                url: window.location.href 
            };

            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                    console.log('Content shared successfully');
                } catch (err) {
                    console.error('Error sharing:', err);
                }
            } else {
                // Fallback for Desktop
                try {
                    await navigator.clipboard.writeText(window.location.href);
                    alert('Link copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy link:', err);
                    alert('Sharing is not supported on this browser.');
                }
            }
        }
    </script>
    <script>
        // install-pwa.js

let deferredPrompt = null;
const installPromptContainer = document.getElementById('install-prompt');
const installButton = document.getElementById('btn-install');
const cancelButton = document.getElementById('btn-cancel-install');
const recentResultsList = document.getElementById('recent-results-list'); // Results list
// --- Check localStorage ---
// Don't show the prompt if 'pwaInstalled' or 'pwaInstallDismissed' is true in localStorage
const isInstalled = localStorage.getItem('pwaInstalled') === 'true';
const isDismissed = localStorage.getItem('pwaInstallDismissed') === 'true';

window.addEventListener('beforeinstallprompt', (e) => {
    // Prevent the default browser mini-infobar
    e.preventDefault();
    console.log('beforeinstallprompt event fired.');

    // Store the event
    deferredPrompt = e;

    // Show custom prompt ONLY if not installed and not dismissed (checked via localStorage)
    if (!isInstalled && !isDismissed) {
        console.log('Showing custom install prompt.');
        if (installPromptContainer) {
            installPromptContainer.classList.add('visible');
        }
    } else {
        console.log('Install prompt criteria met, but localStorage indicates installed or dismissed.');
    }
});

if (installButton) {
    installButton.addEventListener('click', async () => {
        console.log('Install button clicked.');
        // Hide the custom prompt
        if (installPromptContainer) {
            installPromptContainer.classList.remove('visible');
        }

        if (deferredPrompt) {
            // Show the browser's install dialog
            deferredPrompt.prompt();
            console.log('Browser install prompt shown.');

            // Wait for user choice
            try {
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);

                deferredPrompt = null; // Clear the stored prompt

                if (outcome === 'accepted') {
                    console.log('User accepted install.');
                    // --- Save state to localStorage ---
                    localStorage.setItem('pwaInstalled', 'true');
                } else {
                    console.log('User dismissed install prompt.');
                }
            } catch (error) {
                 console.error('Error handling install choice:', error);
                 deferredPrompt = null;
            }
        } else {
            console.log('deferredPrompt not available.');
        }
    });
}

if (cancelButton) {
    cancelButton.addEventListener('click', () => {
        console.log('Cancel button clicked.');
        // Hide the custom prompt
        if (installPromptContainer) {
            installPromptContainer.classList.remove('visible');
        }
        // --- Save state to localStorage ---
        localStorage.setItem('pwaInstallDismissed', 'true');
        console.log('Marked install prompt as dismissed in localStorage.');
    });
}

// Optional: Listen for actual installation
window.addEventListener('appinstalled', () => {
    console.log('PWA was installed');
    if (installPromptContainer) {
        installPromptContainer.classList.remove('visible');
    }
    // --- Ensure state is saved to localStorage ---
    localStorage.setItem('pwaInstalled', 'true');
    deferredPrompt = null;
});
     </script>
</body>
</html>