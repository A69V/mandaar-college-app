<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Match Results - Umang Mandar</title>
    <link rel="stylesheet" href="public-style.css"> <link rel="manifest" href="/manifest.json">
    <style>
        /* Specific styles for results page layout */
        .result-summary-card {
            text-align: center;
            font-size: 1.4em; /* Larger summary text */
            font-weight: 700;
            color: var(--accent-orange, #FF9F55); /* Highlight result */
            padding: 25px 20px !important; /* Increase padding */
            margin-bottom: 30px !important;
        }

        .scorecard-section h2 { /* Style Team Names */
             text-align: left; /* Align team name left */
             font-size: 1.5em;
             color: var(--text-light, white);
             border-bottom: none; /* Remove bottom border */
             margin-bottom: 15px;
             text-shadow: none;
             padding-bottom: 0;
        }
         .scorecard-section h3 { /* Style Batting/Bowling subheads */
             font-size: 1.1em;
             color: var(--accent-blue, #06b6d4);
             margin-top: 15px;
             margin-bottom: 10px;
             padding-bottom: 5px;
             border-bottom: 1px solid rgba(6, 182, 212, 0.2);
         }

        /* Use content-box table styles */
        .content-box table { width: 100%; border-collapse: collapse; font-size: 0.9em; margin-bottom: 20px; }
        .content-box th, .content-box td { padding: 10px 8px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.15); white-space: nowrap; }
        .content-box thead { background-color: rgba(255, 255, 255, 0.05); }
        .content-box th { font-weight: 600; color: var(--accent-orange, #FF9F55); font-size: 0.9em; text-transform: uppercase;}
        .content-box tbody tr:hover { background-color: rgba(255, 255, 255, 0.04); }
        .content-box td:first-child { font-weight: 500; color: #fff;}
        .content-box .stat-num { text-align: right; font-family: monospace; font-size: 1.1em; width: 50px;} /* Keep stat num styling */
        .table-wrapper { overflow-x: auto; }
    </style>
</head>
<body>
    <header>
        <nav class="top-nav">
            <a href="index.html" class="logo"><img src="../mandar-logo.png" alt="Umang Mandar"></a> <ul id="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="sports.html">Sports</a></li>
                <li><a href="timeline.html">Timeline</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            <a href="#" class="live-btn" id="live-btn" style="display: none;">
                <div class="dot-blink"></div> <span id="live-btn-text">LIVE</span>
            </a>
            <button class="menu-toggle-btn" id="menu-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>
        </nav>
    </header>

    <main>
         <div class="header-bar" style="max-width: 1200px; margin: 0 auto 20px auto; padding: 10px 20px; background: none; border: none;"> <a href="#" id="back-link" class="back-button">&lt; Go Back</a>
             </div>

        <div class="content-box" style="max-width: 900px; margin: 0 auto;"> <h1 id="match-title" style="text-align: center; font-size: 1.8em; margin-bottom: 20px;">Loading Match Result...</h1>

            <div class="content-box result-summary-card" id="result-summary-card"> <h2 id="result-summary">...</h2>
            </div>

            <div class="content-box scorecard-section" id="team-a-card"> <h2 id="team-a-name">Team A</h2>
                <h3>Batting</h3>
                <div class="table-wrapper">
                    <table id="team-a-batting"></table>
                </div>
                <h3>Bowling</h3>
                 <div class="table-wrapper">
                    <table id="team-a-bowling"></table>
                 </div>
            </div>

            <div class="content-box scorecard-section" id="team-b-card"> <h2 id="team-b-name">Team B</h2>
                <h3>Batting</h3>
                 <div class="table-wrapper">
                    <table id="team-b-batting"></table>
                 </div>
                <h3>Bowling</h3>
                 <div class="table-wrapper">
                    <table id="team-b-bowling"></table>
                 </div>
            </div>
        </div>
    </main>

    <footer id="contact">
        <p class="made-by">Made with ❤️ by <a href="https://github.com/A69V" target="_blank">Abhinav Shankar</a> | © 2025 GEC Banka Sports Club</p>
    </footer>

    <nav class="bottom-nav">
         <ul>
            <li> <a href="index.html"> <svg></svg> Home </a> </li>
            <li> <a href="#" id="bottom-nav-back"> <svg></svg> Sport Hub </a> </li>
            <li> <a href="timeline.html"> <svg></svg> Timeline </a> </li>
            <li> <a href="gallery.html"> <svg></svg> Gallery </a> </li>
        </ul>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

        // === PASTE YOUR FIREBASE CONFIG HERE ===
        const firebaseConfig = {
            apiKey: "AIzaSyAOtc2UrW2hXO4JJK5ZZQcDOfUVbEFmnis",
            authDomain: "umang-mandar.firebaseapp.com",
            projectId: "umang-mandar",
            storageBucket: "umang-mandar.firebasestorage.app",
            messagingSenderId: "1033556658773",
            appId: "1:1033556658773:web:ed5c606f77e792136ae2dc",
            databaseURL: "https://umang-mandar-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        // === END OF CONFIG ===

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- DOM Elements ---
        const matchTitleEl = document.getElementById('match-title');
        const resultSummaryEl = document.getElementById('result-summary');
        const teamANameEl = document.getElementById('team-a-name');
        const teamBNameEl = document.getElementById('team-b-name');
        const teamABattingTable = document.getElementById('team-a-batting');
        const teamABowlingTable = document.getElementById('team-a-bowling');
        const teamBBattingTable = document.getElementById('team-b-batting');
        const teamBBowlingTable = document.getElementById('team-b-bowling');
        const liveBtn = document.getElementById('live-btn');
        const liveBtnText = document.getElementById('live-btn-text');
        const menuBtn = document.getElementById('menu-toggle');
        const navLinks = document.getElementById('nav-links');
        const backLink = document.getElementById('back-link');
        const bottomNavBack = document.getElementById('bottom-nav-back');


         // --- Helper: Convert Firebase Object/Array ---
         const convertToArray = (obj) => obj && typeof obj === 'object' && !Array.isArray(obj) ? Object.values(obj) : (obj || []); // Return empty array if null/undefined


        // --- Render Functions for Tables ---
        function renderBattingTable(battingData, tableElement) {
            // Ensure data is an array
            const dataArray = convertToArray(battingData);

            tableElement.innerHTML = `
                <thead>
                    <tr>
                        <th>Batsman</th> <th>Dismissal</th>
                        <th class="stat-num">R</th> <th class="stat-num">B</th>
                        <th class="stat-num">4s</th> <th class="stat-num">6s</th>
                        <th class="stat-num">SR</th>
                    </tr>
                 </thead>
                 <tbody></tbody>
            `;
            const tbody = tableElement.querySelector('tbody');
            if (dataArray.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; color: var(--muted);">Did not bat or data unavailable.</td></tr>';
                 return;
            }
            dataArray.forEach(p => {
                const sr = (p.balls > 0) ? (p.runs / p.balls * 100).toFixed(2) : '0.00';
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${p.name || 'Unknown'}</td> <td>${p.dismissal || 'not out'}</td>
                    <td class="stat-num">${p.runs || 0}</td> <td class="stat-num">${p.balls || 0}</td>
                    <td class="stat-num">${p.fours || 0}</td> <td class="stat-num">${p.sixes || 0}</td>
                    <td class="stat-num">${sr}</td>
                `;
            });
        }

        function renderBowlingTable(bowlingData, tableElement) {
             // Ensure data is an array
             const dataArray = convertToArray(bowlingData);

             tableElement.innerHTML = `
                 <thead>
                    <tr>
                        <th>Bowler</th>
                        <th class="stat-num">O</th> <th class="stat-num">M</th>
                        <th class="stat-num">R</th> <th class="stat-num">W</th>
                        <th class="stat-num">Econ</th>
                    </tr>
                 </thead>
                 <tbody></tbody>
            `;
             const tbody = tableElement.querySelector('tbody');
             if (dataArray.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color: var(--muted);">Did not bowl or data unavailable.</td></tr>';
                 return;
             }
            dataArray.forEach(p => {
                const totalBalls = (p.overs || 0) * 6 + (p.balls || 0);
                const econ = (totalBalls > 0) ? ((p.runs || 0) / totalBalls * 6).toFixed(2) : '0.00';
                 const row = tbody.insertRow();
                 row.innerHTML = `
                    <td>${p.name || 'Unknown'}</td>
                    <td class="stat-num">${p.overs || 0}.${p.balls || 0}</td> <td class="stat-num">${p.maidens || 0}</td>
                    <td class="stat-num">${p.runs || 0}</td> <td class="stat-num">${p.wickets || 0}</td>
                    <td class="stat-num">${econ}</td>
                `;
            });
        }


        // --- LOAD MATCH DATA ---
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const matchId = urlParams.get('matchId');

            let sportForBackLink = 'cricket'; // Default sport

            if (!matchId) {
                matchTitleEl.textContent = "Error: No Match ID provided.";
                 if (backLink) backLink.href = './index.html'; // Fallback
                 if (bottomNavBack) bottomNavBack.href = 'index.html';
                return;
            }

            const matchRef = ref(db, `matches/${matchId}`);
            try {
                const snapshot = await get(matchRef);

                if (!snapshot.exists()) {
                    matchTitleEl.textContent = `Error: Match ${matchId} not found.`;
                     if (backLink) backLink.href = './index.html'; // Fallback
                     if (bottomNavBack) bottomNavBack.href = 'index.html';
                    return;
                }

                const state = snapshot.val();
                sportForBackLink = state.sport || 'cricket'; // Get sport from match data

                matchTitleEl.textContent = `${state.teamA?.name || 'Team A'} vs ${state.teamB?.name || 'Team B'}`;
                resultSummaryEl.textContent = state.result || "Match result pending.";

                teamANameEl.textContent = state.teamA?.name || 'Team A';
                teamBNameEl.textContent = state.teamB?.name || 'Team B';

                // Render Scorecards (checking if scorecard data exists)
                renderBattingTable(state.scorecard?.teamA?.batting, teamABattingTable);
                renderBowlingTable(state.scorecard?.teamA?.bowling, teamABowlingTable);
                renderBattingTable(state.scorecard?.teamB?.batting, teamBBattingTable);
                renderBowlingTable(state.scorecard?.teamB?.bowling, teamBBowlingTable);

            } catch (error) {
                 console.error("Error fetching match data:", error);
                 matchTitleEl.textContent = "Error loading match data.";
                 resultSummaryEl.textContent = "Could not load result.";
                  if (backLink) backLink.href = './index.html'; // Fallback
                  if (bottomNavBack) bottomNavBack.href = 'index.html';
            }

             // --- Set Back Button Links ---
             const sportHubUrl = `sport-details.html?sport=${sportForBackLink}`; // Use sport from data
             if (backLink) {
                 backLink.href = './index.html';
                 backLink.style.display = 'inline-block'; // Show the button
             }
             if(bottomNavBack){
                 bottomNavBack.href = sportHubUrl;
             }
        });


         // --- Live Button Logic (Checks if ANY match is live) ---
         const allMatchesRef = ref(db, 'matches');
         let liveSubscription = onValue(allMatchesRef, (snapshot) => {
             let liveMatchFound = false; let firstLiveMatchId = null;
             if (snapshot.exists()) {
                 const matches = snapshot.val();
                 for (const matchId in matches) {
                     const match = matches[matchId];
                     if (match.status === 'live' || match.live?.matchStatus === "Innings Break") {
                         liveMatchFound = true; firstLiveMatchId = matchId; break;
                     }
                 }
             }
             if (liveMatchFound) {
                 liveBtn.href = `live-scorecard.html?matchId=${firstLiveMatchId}`;
                 liveBtnText.textContent = 'LIVE SCORE';
                 liveBtn.style.display = 'flex';
             } else {
                 liveBtn.style.display = 'none';
             }
         }, (error) => { console.error("Error checking live matches:", error); liveBtn.style.display = 'none'; });

         // --- Mobile Menu Toggle ---
         if(menuBtn && navLinks) {
             menuBtn.addEventListener('click', (e) => {
                 e.stopPropagation(); navLinks.classList.toggle('mobile-nav-active');
             });
             document.addEventListener('click', (e) => {
                 if (navLinks.classList.contains('mobile-nav-active') && !navLinks.contains(e.target) && !menuBtn.contains(e.target)) {
                     navLinks.classList.remove('mobile-nav-active');
                 }
             });
         }

    </script>
</body>
</html>